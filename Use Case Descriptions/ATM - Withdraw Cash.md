# รายละเอียด Use Case: ถอนเงินจาก ATM

## Use Case ID
UC-ATM-001

## ชื่อ Use Case
ถอนเงินสดจาก ATM (Withdraw Cash from ATM)

## คำอธิบายโดยย่อ
Use case นี้อนุญาตให้ลูกค้าถอนเงินสดจากบัญชีธนาคารผ่านตู้ ATM

## Actors (ผู้มีส่วนเกี่ยวข้อง)
- **Primary Actor**: ลูกค้า (Customer)
- **Secondary Actors**: ระบบธนาคาร (Bank System), ตู้ ATM (ATM Machine)

## Preconditions (เงื่อนไขเบื้องต้น)
1. ตู้ ATM ต้องพร้อมใช้งานและมีเงินสดเพียงพอ
2. ลูกค้าต้องมีบัตร ATM ที่ใช้งานได้
3. บัญชีของลูกค้าต้องเปิดใช้งาน
4. มีการเชื่อมต่อเครือข่ายกับระบบธนาคาร

## Postconditions (เงื่อนไขปลายทาง)
**กรณีสำเร็จ:**
- เงินสดถูกจ่ายออกมา
- เงินถูกหักออกจากบัญชีลูกค้า
- ใบเสร็จถูกพิมพ์
- บัตรถูกส่งคืน

**กรณีล้มเหลว:**
- ไม่มีการจ่ายเงินสด
- ไม่มีการหักเงิน
- แสดงข้อความแจ้งข้อผิดพลาด
- บัตรถูกส่งคืนหรือกักเก็บ (ถ้าถูกบล็อก)

## Main Flow (ขั้นตอนหลัก)
1. ลูกค้าใส่บัตร ATM เข้าเครื่อง
2. ATM อ่านข้อมูลบัตร
3. ATM แสดงหน้าจอให้ใส่รหัส PIN
4. ลูกค้าใส่รหัส PIN
5. ATM ตรวจสอบรหัส PIN กับระบบธนาคาร
6. ATM แสดงเมนูหลัก
7. ลูกค้าเลือก "ถอนเงินสด"
8. ATM แสดงหน้าจอให้ระบุจำนวนเงิน
9. ลูกค้าระบุจำนวนเงินที่ต้องการถอน
10. ATM ตรวจสอบจำนวนเงิน (ขั้นต่ำ/สูงสุด)
11. ATM ตรวจสอบยอดเงินในบัญชีกับระบบธนาคาร
12. ATM จ่ายเงินสด
13. ATM อัพเดทยอดเงินในบัญชี
14. ATM พิมพ์ใบเสร็จ
15. ATM ส่งบัตรคืน
16. ลูกค้ารับเงินสด ใบเสร็จ และบัตร

## Alternative Flows (ขั้นตอนทางเลือก)

### AF1: รหัส PIN ผิด
**ที่ขั้นตอนที่ 5:**
- ATM ตรวจพบรหัส PIN ไม่ถูกต้อง
- ATM แสดงข้อความแจ้งข้อผิดพลาด
- ATM ให้ใส่รหัส PIN ใหม่
- หากพยายามน้อยกว่า 3 ครั้ง กลับไปขั้นตอนที่ 4
- หากพยายาม 3 ครั้ง บัตรจะถูกบล็อกและกักเก็บ

### AF2: ยอดเงินไม่เพียงพอ
**ที่ขั้นตอนที่ 11:**
- ระบบธนาคารตรวจพบยอดเงินไม่เพียงพอ
- ATM แสดงข้อความแจ้งข้อผิดพลาด
- ATM กลับไปที่เมนูหลัก
- ลูกค้าสามารถเลือกจำนวนอื่นหรือยกเลิก

### AF3: เกินวงเงินถอนรายวัน
**ที่ขั้นตอนที่ 10:**
- ระบบตรวจพบเกินวงเงินถอนรายวัน
- ATM แสดงวงเงินคงเหลือที่สามารถถอนได้
- ลูกค้าสามารถระบุจำนวนภายในวงเงินหรือยกเลิก

### AF4: ATM เงินสดหมด
**ที่ขั้นตอนที่ 12:**
- ATM ตรวจพบเงินสดในเครื่องไม่เพียงพอ
- ATM แสดง "บริการชั่วคราวไม่พร้อมใช้งาน"
- ธุรกรรมถูกยกเลิก
- บัตรถูกส่งคืน

## Exception Flows (ขั้นตอนข้อผิดพลาด)

### EF1: อ่านบัตรไม่ได้
**ที่ขั้นตอนที่ 2:**
- ATM ไม่สามารถอ่านบัตรได้
- ATM แสดง "ข้อผิดพลาดบัตร - กรุณาลองใหม่อีกครั้ง"
- ATM ส่งบัตรคืน
- ธุรกรรมถูกยกเลิก

### EF2: สัญญาณเครือข่ายขาดหาย
**ที่ขั้นตอนใดก็ได้ที่ต้องใช้ระบบธนาคาร:**
- การเชื่อมต่อกับระบบธนาคารล้มเหลว
- ATM แสดง "ไม่สามารถเชื่อมต่อได้ - กรุณาลองใหม่ภายหลัง"
- ธุรกรรมถูกยกเลิก
- บัตรถูกส่งคืน

### EF3: Timeout ของลูกค้า
**ที่ขั้นตอนการใส่ข้อมูลใดก็ได้:**
- ลูกค้าใช้เวลามากกว่า 60 วินาที
- ATM แสดงคำเตือน timeout
- หลังจาก 15 วินาที ATM ยกเลิกธุรกรรม
- บัตรถูกส่งออกมา

## Special Requirements (ข้อกำหนดพิเศษ)
- **ความปลอดภัย:**
  - รหัส PIN ต้องถูกเข้ารหัสระหว่างการส่งข้อมูล
  - จำกัดการใส่ PIN ได้สูงสุด 3 ครั้ง
  - Timeout หน้าจอหลังจาก 60 วินาที
- **ประสิทธิภาพ:**
  - การตรวจสอบ PIN ภายใน 3 วินาที
  - การจ่ายเงินสดภายใน 10 วินาที
- **การใช้งาน:**
  - คำแนะนำชัดเจนบนหน้าจอ
  - มีเสียงแนะนำสำหรับผู้พิการทางสายตา
- **ความพร้อมใช้งาน**: ATM ควรพร้อมใช้งาน 24/7

## Frequency of Use (ความถี่ในการใช้งาน)
สูงมาก - หลายร้อยครั้งต่อวันต่อเครื่อง ATM

## Business Rules (กฎทางธุรกิจ)
1. จำนวนเงินขั้นต่ำในการถอน: 100 บาท
2. จำนวนสูงสุดต่อรายการ: 20,000 บาท
3. วงเงินถอนรายวัน: 100,000 บาท
4. จ่ายเฉพาะธนบัตร 100, 500 และ 1,000 บาท
5. จำนวนเงินต้องเป็นทวีคูณของ 100 บาท
6. ค่าธรรมเนียม: ฟรีสำหรับธนาคารเดียวกัน, 15 บาทสำหรับต่างธนาคาร
